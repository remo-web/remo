(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{"2d9n":function(t,e,n){"use strict";var i=n("F/us"),o=n("0h2I"),r=n("RN+F"),s=n("czxF");function a(){s.call(this),this.fUpload=null,this.fCancel=null,this.message=o.observable(""),this.filesConfirmText=o.observable(""),this.sErrorText=o.observable("")}i.extendOwn(a.prototype,s.prototype),a.prototype.PopupTemplate="CoreParanoidEncryptionWebclientPlugin_ConfirmUploadPopup",a.prototype.onOpen=function(t,e,n,o,s){var a=i.map(o,(function(t){return r.encodeHtml(t)}));this.filesConfirmText(""),this.fUpload=t,this.fCancel=e,this.message(r.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/CONFIRM_UPLOAD_PLURAL",{VALUE:n>1?n:'"'+o[0]+'"'},null,n)),n>1&&this.filesConfirmText(a.join("<br />")),this.sErrorText(s)},a.prototype.cancelUpload=function(){this.fCancel(),this.closePopup()},a.prototype.upload=function(){this.fUpload(),this.closePopup()},t.exports=new a},"2kfa":function(t,e,n){"use strict";var i=n("F/us"),o=n("0h2I"),r=n("IAk5"),s=n("czxF"),a=n("zDR0");function l(){s.call(this),this.keyName=o.observable(r.getUserPublicId()),this.fOnGenerateCallback=null}i.extendOwn(l.prototype,s.prototype),l.prototype.PopupTemplate="CoreParanoidEncryptionWebclientPlugin_GenerateKeyPopup",l.prototype.onOpen=function(t){this.fOnGenerateCallback=t},l.prototype.generateKey=function(){a.generateKey(i.bind((function(){this.fOnGenerateCallback()}),this),this.keyName()),this.closePopup()},t.exports=new l},B9Yq:function(t,e){t.exports=function(){throw new Error("define cannot be used indirect")}},I5pT:function(t,e,n){"use strict";var i=n("0h2I"),o=n("F/us"),r=n("AFLV");t.exports={ServerModuleName:"CoreParanoidEncryptionWebclientPlugin",HashModuleName:"paranoid-encryption",EncryptionAllowedModules:["Files"],EncryptionAllowedStorages:["personal","corporate"],EnableJscrypto:i.observable(!0),EncryptionMode:i.observable(Enums.EncryptionMode.Always),ChunkSizeMb:5,AllowMultiChunkUpload:!0,AllowChangeSettings:!1,init:function(t){var e=o.extend({},t[this.ServerModuleName]||{},t.CoreParanoidEncryptionWebclientPlugin||{});o.isEmpty(e)||(this.EnableJscrypto(r.pBool(e.EnableModule,this.EnableJscrypto())),this.EncryptionMode(r.pEnum(e.EncryptionMode,Enums.EncryptionMode,this.EncryptionMode())),this.ChunkSizeMb=r.pInt(e.ChunkSizeMb,this.ChunkSizeMb),this.AllowMultiChunkUpload=r.pBool(e.AllowMultiChunkUpload,this.AllowMultiChunkUpload),this.AllowChangeSettings=r.pBool(e.AllowChangeSettings,this.AllowChangeSettings))},update:function(t,e){this.EnableJscrypto(t),this.EncryptionMode(r.pInt(e))}}},LU2F:function(t,e,n){"use strict";var i=n("F/us"),o=n("0h2I"),r=n("czxF");function s(){r.call(this),this.keyPassword=o.observable(""),this.fOnPasswordEnterCallback=null,this.fOnCancellCallback=null}i.extendOwn(s.prototype,r.prototype),s.prototype.PopupTemplate="CoreParanoidEncryptionWebclientPlugin_DecryptKeyPasswordPopup",s.prototype.onOpen=function(t,e){this.fOnPasswordEnterCallback=t,this.fOnCancellCallback=e},s.prototype.decryptKey=function(){i.isFunction(this.fOnPasswordEnterCallback)&&this.fOnPasswordEnterCallback(this.keyPassword()),this.closePopup()},s.prototype.cancelPopup=function(){i.isFunction(this.fOnCancellCallback)&&this.fOnCancellCallback(),this.closePopup()},s.prototype.onShow=function(){this.keyPassword("")},t.exports=new s},Npm9:function(t,e,n){"use strict";var i=n("F/us"),o=n("0h2I"),r=n("IAk5"),s=n("czxF"),a=n("zDR0");function l(){s.call(this),this.keyName=o.observable(r.getUserPublicId()),this.newKey=o.observable("")}i.extendOwn(l.prototype,s.prototype),l.prototype.PopupTemplate="CoreParanoidEncryptionWebclientPlugin_ImportKeyStringPopup",l.prototype.onOpen=function(){this.newKey("")},l.prototype.importKey=function(){a.importKeyFromString(this.keyName(),this.newKey()),this.closePopup()},t.exports=new l},PDX0:function(t,e){(function(e){t.exports=e}).call(this,{})},QJDP:function(t,e,n){"use strict";var i=n("EVdn"),o=n("F/us"),r=n("SQrT"),s=n("RN+F"),a=n("uN/E"),l=n("zDR0"),c=n("wjWM"),u=n("I5pT");function h(){this.iChunkNumber=0,this.iChunkSize=1024*u.ChunkSizeMb*1024,this.iCurrChunk=0,this.oChunk=null,this.iv=null,this.oChunkQueue={isProcessed:!1,aFiles:[]},this.aStopList=[],this.fOnUploadCancelCallback=null}function p(t,e,n,i){this.oFile=t,this.sFileName=t.fileName(),this.iFileSize=t.size(),this.sDownloadLink=t.getActionUrl("download"),this.oWriter=new E(this.sFileName,i),this.iCurrChunk=0,this.iv=new Uint8Array(c.HexString2Array(e)),this.key=null,this.iChunkNumber=Math.ceil(this.iFileSize/n),this.iChunkSize=n,l.getKey(o.bind((function(t){this.key=t,this.decryptChunk()}),this),o.bind((function(){this.stopDownloading()}),this))}function d(t,e,n){this.oFile=t,this.sFileName=t.fileName(),this.iFileSize=t.size(),this.sDownloadLink=t.getActionUrl("download"),this.oWriter=null,this.iCurrChunk=0,this.iv=new Uint8Array(c.HexString2Array(e)),this.key=null,this.iChunkNumber=Math.ceil(this.iFileSize/n),this.iChunkSize=n,l.getKey(o.bind((function(t){this.key=t,this.decryptChunk()}),this))}function E(t,e){this.sName=t,this.aBuffer=[],o.isFunction(e)&&(this.fProcessBlobCallback=e)}function y(t){this.sName=t,this.aBuffer=[],this.imgWindow=window.open("","_blank","height=auto, width=auto,toolbar=no,scrollbars=no,resizable=yes")}h.prototype.start=function(t){this.oFileInfo=t,this.oFile=t.File,this.iChunkNumber=Math.ceil(t.File.size/this.iChunkSize),this.iCurrChunk=0,this.oChunk=null,this.iv=window.crypto.getRandomValues(new Uint8Array(16)),this.oFileInfo.Hidden={RangeType:1},this.oFileInfo.Hidden.ExtendedProps={InitializationVector:c.Array2HexString(new Uint8Array(this.iv))}},h.prototype.startUpload=function(t,e,n,i){this.oChunkQueue.isProcessed=!0,this.start(t),l.getKey(o.bind((function(){this.readChunk(e,n)}),this),i)},h.prototype.cryptoKey=function(){return l.key()},h.prototype.readChunk=function(t,e){var n=this.iChunkSize*this.iCurrChunk,i=this.iCurrChunk<this.iChunkNumber-1?this.iChunkSize*(this.iCurrChunk+1):this.oFile.size,a=new FileReader,l=null;if(-1!==this.aStopList.indexOf(t))return this.aStopList.splice(this.aStopList.indexOf(t),1),void this.checkQueue();if(this.oFile.slice?l=this.oFile.slice(n,i):this.oFile.webkitSlice?l=this.oFile.webkitSlice(n,i):this.oFile.mozSlice&&(l=this.oFile.mozSlice(n,i)),l)try{a.onloadend=o.bind((function(n){n.target.readyState===FileReader.DONE&&(this.oChunk=n.target.result,this.iCurrChunk++,this.encryptChunk(t,e))}),this),a.readAsArrayBuffer(l)}catch(t){r.showError(s.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_ENCRYPTION"))}},h.prototype.encryptChunk=function(t,e){crypto.subtle.encrypt({name:"AES-CBC",iv:this.iv},this.cryptoKey(),this.oChunk).then(o.bind((function(n){n=this.iChunkNumber>1&&this.iCurrChunk!==this.iChunkNumber?n.slice(0,n.byteLength-16):n;var i=new Blob([n],{type:"text/plain",lastModified:new Date}),r=o.bind((function(t,e){this.iCurrChunk<this.iChunkNumber?this.readChunk(t,e):(this.oChunkQueue.isProcessed=!1,this.checkQueue())}),this);this.oFileInfo.File=i,this.iv=new Uint8Array(n.slice(n.byteLength-16)),1===this.iCurrChunk?this.oFileInfo.Hidden.ExtendedProps.FirstChunk=!0:delete this.oFileInfo.Hidden.ExtendedProps.FirstChunk,this.iCurrChunk==this.iChunkNumber?delete this.oFileInfo.Hidden.ExtendedProps.Loading:this.oFileInfo.Hidden.ExtendedProps.Loading=!0,e(t,this.oFileInfo,r,this.iCurrChunk,this.iChunkNumber,(this.iCurrChunk-1)*this.iChunkSize)}),this)).catch((function(t){r.showError(s.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_ENCRYPTION"))}))},h.prototype.downloadDividedFile=function(t,e,n){new p(t,e,this.iChunkSize,n)},h.prototype.checkQueue=function(){var t=null;this.oChunkQueue.aFiles.length>0&&(t=this.oChunkQueue.aFiles.shift()).fStartUploadCallback.apply(t.fStartUploadCallback,[t.oFileInfo,t.sUid,t.fOnChunkEncryptCallback])},h.prototype.stopUploading=function(t,e,n){var i=!1;this.oChunkQueue.aFiles.forEach((function(n,o,r){n.sUid===t&&(e(t,n.oFileInfo.FileName),r.splice(o,1),i=!0)})),i||(this.aStopList.push(t),this.oChunkQueue.isProcessed=!1,e(t,n))},h.prototype.viewEncryptedImage=function(t,e){this.isKeyInStorage()?new d(t,e,this.iChunkSize):r.showError(s.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/INFO_EMPTY_JSCRYPTO_KEY"))},h.prototype.isKeyInStorage=function(){return!!l.loadKeyFromStorage()},p.prototype.writeChunk=function(t){!0===this.oFile.downloading()&&(this.oWriter.write(t),this.iCurrChunk<this.iChunkNumber?this.decryptChunk():(this.stopDownloading(),this.oWriter.close()))},p.prototype.decryptChunk=function(){var t=new XMLHttpRequest;t.open("GET",this.getChunkLink(),!0),t.responseType="arraybuffer",t.onprogress=o.bind((function(e){this.isDownloading()?this.oFile.onDownloadProgress(e.loaded+(this.iCurrChunk-1)*this.iChunkSize,this.iFileSize):t.abort()}),this),t.onload=o.bind((function(e){var n=t.response,i={};200===t.status&&n&&((i=new Uint8Array(n.byteLength+16)).set(new Uint8Array(n),0),this.iCurrChunk!==this.iChunkNumber?crypto.subtle.encrypt({name:"AES-CBC",iv:new Uint8Array(n.slice(n.byteLength-16))},this.key,new Uint8Array([16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16]).buffer).then(o.bind((function(t){i.set(new Uint8Array(new Uint8Array(t.slice(0,16))),n.byteLength),crypto.subtle.decrypt({name:"AES-CBC",iv:this.iv},this.key,i.buffer).then(o.bind((function(t){var e=new Uint8Array(t);this.iv=new Uint8Array(n.slice(n.byteLength-16)),this.writeChunk(e)}),this)).catch(o.bind((function(t){this.stopDownloading(),r.showError(s.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_DECRYPTION"))}),this))}),this)):crypto.subtle.decrypt({name:"AES-CBC",iv:this.iv},this.key,n).then(o.bind((function(t){var e=new Uint8Array(t);this.iv=new Uint8Array(n.slice(n.byteLength-16)),this.writeChunk(e)}),this)).catch(o.bind((function(t){this.stopDownloading(),r.showError(s.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_DECRYPTION"))}),this)))}),this),t.send(null)},p.prototype.stopDownloading=function(){this.oFile.stopDownloading()},p.prototype.getChunkLink=function(){return this.sDownloadLink+"/download/"+this.iCurrChunk+++"/"+this.iChunkSize},p.prototype.isDownloading=function(){return this.oFile.downloading()},d.prototype=Object.create(p.prototype),d.prototype.constructor=d,d.prototype.writeChunk=function(t){this.oWriter=null===this.oWriter?new y(this.sFileName):this.oWriter,this.oWriter.write(t),this.iCurrChunk<this.iChunkNumber?this.decryptChunk():(this.stopDownloading(),this.oWriter.close())},p.prototype.isDownloading=function(){return!0},E.prototype.write=function(t){this.aBuffer.push(t)},E.prototype.close=function(){let t=new Blob(this.aBuffer);void 0!==this.fProcessBlobCallback?this.fProcessBlobCallback(t):a.saveAs(t,this.sName),t=null},y.prototype=Object.create(E.prototype),y.prototype.constructor=y,y.prototype.close=function(){try{var t=new Blob(this.aBuffer),e=window.URL.createObjectURL(t);this.imgWindow.document.write("<head><title>"+this.sName+'</title></head><body><img src="'+e+'" /></body>'),i(this.imgWindow.document.body).find("img").on("load",(function(){window.URL.revokeObjectURL(e)}))}catch(t){r.showError(s.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_POPUP_WINDOWS"))}},t.exports=new h},c2EW:function(t,e,n){"use strict";var i=n("F/us"),o=n("0h2I"),r=n("RN+F"),s=n("czxF");function a(){s.call(this),this.fEncrypt=null,this.fUpload=null,this.fCancel=null,this.message=o.observable(""),this.filesConfirmText=o.observable("")}i.extendOwn(a.prototype,s.prototype),a.prototype.PopupTemplate="CoreParanoidEncryptionWebclientPlugin_ConfirmEncryptionPopup",a.prototype.onOpen=function(t,e,n,o,s){var a=i.map(s,(function(t){return r.encodeHtml(t)}));this.filesConfirmText(""),this.fEncrypt=t,this.fUpload=e,this.fCancel=n,this.message(r.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/CONFIRM_ENCRYPT_PLURAL",{VALUE:o>1?o:'"'+s[0]+'"'},null,o)),o>1&&this.filesConfirmText(a.join("<br />"))},a.prototype.cancelUpload=function(){this.fCancel(),this.closePopup()},a.prototype.encrypt=function(){this.fEncrypt(),this.closePopup()},a.prototype.upload=function(){this.fUpload(),this.closePopup()},t.exports=new a},hYvh:function(t,e,n){"use strict";var i=n("F/us"),o={EncryptionMode:{Always:0,AskMe:1,Never:2,AlwaysInEncryptedFolder:3}};void 0===window.Enums&&(window.Enums={}),i.extendOwn(window.Enums,o)},"mHl/":function(t,e,n){"use strict";var i=n("F/us"),o=n("EVdn"),r=n("0h2I"),s=n("RN+F"),a=n("AFLV"),l=n("OgeD"),c=n("SQrT"),u=l.run("SettingsWebclient","getAbstractSettingsFormViewClass"),h=n("76Kh"),p=n("zDR0"),d=n("I5pT"),E=n("Npm9"),y=n("2kfa"),f=n("t19A"),C=n("nTW+"),N=n("wjWM");function w(){u.call(this,d.ServerModuleName),this.enableJscrypto=r.observable(d.EnableJscrypto()),this.keyName=r.observable(""),this.bIsHttpsEnable="https:"===window.location.protocol,this.encryptionMode=r.observable(d.EncryptionMode()),this.allowChangeSettings=r.observable(d.AllowChangeSettings),this.isImporting=r.observable(!1),this.exportKeyBound=i.bind(this.exportKey,this),r.isObservable(p.keyName)&&p.keyName.subscribe((function(){this.keyName(p.keyName())}),this)}i.extendOwn(w.prototype,u.prototype),w.prototype.ViewTemplate="CoreParanoidEncryptionWebclientPlugin_ParanoidEncryptionSettingsFormView",w.prototype.importFileKey=function(){o("#import-key-file").click()},w.prototype.importStringKey=function(){h.showPopup(E)},w.prototype.readKeyFromFile=function(){var t,e=document.getElementById("import-key-file"),n=e.files[0],o=new FileReader,r="",a=e.files[0].name.split("."),l=i.bind((function(){this.isImporting(!1)}),this),u=i.bind((function(){this.isImporting(!1)}),this);if(a.splice(a.length-1,1),t=a.join(""),n){this.isImporting(!0),o.onload=function(e){r=e.target.result,p.importKeyFromString(t,r,l,u)};try{o.readAsText(n)}catch(t){c.showError(s.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_IMPORT_KEY"))}}else c.showError(s.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_IMPORT_KEY"))},w.prototype.generateNewKey=function(){h.showPopup(y,[i.bind((function(){h.showPopup(f,[this.exportKeyBound,this.keyName()])}),this)])},w.prototype.removeJscryptoKey=function(){var t=i.bind((function(t){t&&(p.deleteKey().error&&c.showError(s.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_DELETE_KEY")))}),this);h.showPopup(C,[this.exportKeyBound,this.keyName(),t])},w.prototype.getCurrentValues=function(){return[this.enableJscrypto(),this.encryptionMode()]},w.prototype.revertGlobalValues=function(){this.enableJscrypto(d.EnableJscrypto()),this.encryptionMode(d.EncryptionMode())},w.prototype.getParametersForSave=function(){return{EnableModule:this.enableJscrypto(),EncryptionMode:a.pInt(this.encryptionMode())}},w.prototype.applySavedValues=function(){d.update(this.enableJscrypto(),this.encryptionMode())},w.prototype.onShow=function(){p.loadKeyNameFromStorage()},w.prototype.exportKey=function(){var t=null,e=null,n=document.createElement("a");p.getKey(i.bind((function(o){o?p.exportKey().then(i.bind((function(i){t=new Blob([N.Array2HexString(new Uint8Array(i))],{type:"text/plain"}),e=window.URL.createObjectURL(t),document.body.appendChild(n),n.style="display: none",n.href=e,n.download=this.keyName(),n.click(),window.URL.revokeObjectURL(e)}),this)).catch((function(){c.showError(s.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_LOAD_KEY"))})):c.showError(s.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_LOAD_KEY"))}),this),!1,!1,!0)},t.exports=new w},mtgd:function(t,e,n){"use strict";(function(e){var i=n("F/us"),o=n("0h2I"),r=n("czxF"),s=n("RN+F"),a=n("SQrT");function l(){r.call(this),this.keyPassword=o.observable(""),this.keyPasswordConfirm=o.observable(""),this.fOnPasswordEnterCallback=null,this.fOnWrongPasswordCallback=null,this.fOnCancellCallback=null}i.extendOwn(l.prototype,r.prototype),l.prototype.PopupTemplate="CoreParanoidEncryptionWebclientPlugin_EncryptKeyPasswordPopup",l.prototype.onOpen=function(t,e){this.fOnPasswordEnterCallback=t,this.fOnCancellCallback=e},l.prototype.encryptKey=function(){""===e.trim(this.keyPassword())?this.showError(s.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_PASSWORD_CANT_BE_BLANK")):e.trim(this.keyPassword())!==e.trim(this.keyPasswordConfirm())?this.showError(s.i18n("COREWEBCLIENT/ERROR_PASSWORDS_DO_NOT_MATCH")):(i.isFunction(this.fOnPasswordEnterCallback)&&this.fOnPasswordEnterCallback(e.trim(this.keyPassword())),this.closePopup())},l.prototype.cancelPopup=function(){i.isFunction(this.fOnCancellCallback)&&this.fOnCancellCallback(),this.closePopup()},l.prototype.onShow=function(){this.keyPassword(""),this.keyPasswordConfirm("")},l.prototype.showError=function(t){a.showError(t)},t.exports=new l}).call(this,n("EVdn"))},"nTW+":function(t,e,n){"use strict";var i=n("F/us"),o=n("0h2I"),r=n("RN+F"),s=n("czxF"),a=n("76Kh"),l=n("20Ah");function c(){s.call(this),this.fExportKeyCallback=null,this.keyName=o.observable(""),this.fDelete=null,this.fDeleteCallback=null}i.extendOwn(c.prototype,s.prototype),c.prototype.PopupTemplate="CoreParanoidEncryptionWebclientPlugin_DeleteKeyPopup",c.prototype.onOpen=function(t,e,n){i.isFunction(t)&&(this.fExportKeyCallback=i.bind((function(){this.closePopup(),t()}),this)),this.keyName(e),this.fDeleteCallback=i.bind((function(t){n.call(this,t),t?this.closePopup():this.showPopup()}),this)},c.prototype.deleteKey=function(){this.hidePopup(),a.showPopup(l,[r.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/CONFIRM_DELETE_KEY"),this.fDeleteCallback])},t.exports=new c},oBzO:function(t,e,n){"use strict";n("hYvh");var i=n("F/us"),o=n("IAk5"),r=n("RN+F"),s=n("SQrT"),a=null,l=n("I5pT"),c=n("76Kh"),u=n("c2EW"),h=n("2d9n"),p=n("HLSX"),d=[],E=!1,y=null;function f(){return"https:"===window.location.protocol}function C(t,e,n,o,r){E?d.push({sUid:t,oFileInfo:e}):(setTimeout((function(){c.showPopup(h,[n,o,d.length,i.map(d,(function(t){return t.oFileInfo.FileName})),r])}),10),E=!0,d.push({sUid:t,oFileInfo:e}))}function N(t){t.run("SettingsWebclient","registerSettingsTab",[function(){return n("mHl/")},l.HashModuleName,r.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/LABEL_SETTINGS_TAB")]),o.subscribeEvent("AbstractFileModel::FileDownload::before",(function(t){var e=t.File,n="oExtendedProps"in e&&("InitializationVector"in e.oExtendedProps&&e.oExtendedProps.InitializationVector);l.EnableJscrypto()&&n&&e.sOwnerName===o.getUserPublicId()&&(f()?a.isKeyInStorage()?t.CustomDownloadHandler=function(){e.startDownloading(),a.downloadDividedFile(e,n)}:(s.showError(r.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/INFO_EMPTY_JSCRYPTO_KEY")),t.CancelDownload=!0):(s.showError(r.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_HTTPS_NEEDED")),t.CancelDownload=!0))})),o.subscribeEvent("OpenPgpFilesWebclient::DownloadSecureFile",(function(t){var e=t.File,n="oExtendedProps"in e&&("InitializationVector"in e.oExtendedProps&&e.oExtendedProps.InitializationVector),i=t.fProcessBlobCallback;l.EnableJscrypto()&&n&&e.sOwnerName===o.getUserPublicId()?f()?a.isKeyInStorage()?(e.startDownloading(),a.downloadDividedFile(e,n,i)):(s.showError(r.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/INFO_EMPTY_JSCRYPTO_KEY")),t.CancelDownload=!0):(s.showError(r.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_HTTPS_NEEDED")),t.CancelDownload=!0):s.showError(r.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_СANT_DECRYPT_FILE"))})),o.subscribeEvent("Jua::FileUpload::before",(function(t){var e=t.sUid,n=t.sModuleName,o=t.oFileInfo,h=t.fOnChunkReadyCallback,p=t.fRegularUploadFileCallback,y=t.fCancelFunction,N=function(t,e,n){!l.AllowMultiChunkUpload&&t.File.size>a.iChunkSize?(s.showError(r.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_FILE_SIZE_LIMIT",{VALUE:l.ChunkSizeMb})),y(e),a.oChunkQueue.isProcessed=!1,a.checkQueue()):a.startUpload(t,e,n,i.bind((function(){y(e),a.oChunkQueue.isProcessed=!1,a.checkQueue()}),this))},w=i.bind((function(){d.forEach((function(t){p(t.sUid,t.oFileInfo)})),d=[],E=!1}),this),P=i.bind((function(){d.forEach((function(t){a.oChunkQueue.aFiles.push({fStartUploadCallback:N,oFileInfo:t.oFileInfo,sUid:t.sUid,fOnChunkEncryptCallback:h})})),d=[],E=!1,a.oChunkQueue.isProcessed||(a.oChunkQueue.isProcessed=!0,a.checkQueue())})),b=i.bind((function(){d.forEach((function(t){y(t.sUid)})),d=[],E=!1}));!l.EnableJscrypto()||l.EncryptionAllowedModules&&l.EncryptionAllowedModules.length>0&&!l.EncryptionAllowedModules.includes(n)||!l.EncryptionAllowedStorages.includes(t.sStorageType)&&"encrypted"!==t.sStorageType||l.EncryptionMode()===Enums.EncryptionMode.Never||l.EncryptionMode()===Enums.EncryptionMode.AlwaysInEncryptedFolder&&"encrypted"!==t.sStorageType?p(e,o):f()?a.isKeyInStorage()?l.EncryptionMode()===Enums.EncryptionMode.AskMe?E?d.push({sUid:e,oFileInfo:o}):(setTimeout((function(){c.showPopup(u,[P,w,b,d.length,i.map(d,(function(t){return t.oFileInfo.FileName}))])}),10),E=!0,d.push({sUid:e,oFileInfo:o})):!0===a.oChunkQueue.isProcessed?a.oChunkQueue.aFiles.push({fStartUploadCallback:N,oFileInfo:o,sUid:e,fOnChunkEncryptCallback:h}):N(o,e,h):l.EncryptionMode()===Enums.EncryptionMode.Always||l.EncryptionMode()===Enums.EncryptionMode.AlwaysInEncryptedFolder?(s.showError(r.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/INFO_EMPTY_JSCRYPTO_KEY")),y(e)):l.EncryptionMode()===Enums.EncryptionMode.AskMe&&C(e,o,w,b,r.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/INFO_EMPTY_JSCRYPTO_KEY")):l.EncryptionMode()===Enums.EncryptionMode.Always||l.EncryptionMode()===Enums.EncryptionMode.AlwaysInEncryptedFolder?(s.showError(r.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_HTTPS_NEEDED")),y(e)):l.EncryptionMode()===Enums.EncryptionMode.AskMe&&C(e,o,w,b,r.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_HTTPS_NEEDED"))})),o.subscribeEvent("CFilesView::FileDownloadCancel",(function(t){l.EnableJscrypto()&&f()&&t.oFile.stopDownloading()})),o.subscribeEvent("CFilesView::FileUploadCancel",(function(t){l.EnableJscrypto()&&f()?(a.oChunkQueue.aFiles.forEach((function(e,n,i){t.fOnUploadCancelCallback(e.sUid,e.oFileInfo.FileName)})),a.oChunkQueue.aFiles=[],a.stopUploading(t.sFileUploadUid,t.fOnUploadCancelCallback,t.sFileUploadName)):i.isFunction(t.fOnUploadCancelCallback)&&t.fOnUploadCancelCallback(t.sFileUploadUid,t.sFileUploadName)})),o.subscribeEvent("Jua::FileUploadingError",(function(){l.EnableJscrypto()&&f()&&(a.oChunkQueue.isProcessed=!1,a.checkQueue())})),o.subscribeEvent("FilesWebclient::ParseFile::after",(function(t){var e=t[0],n=void 0!==e.oExtendedProps&&void 0!==e.oExtendedProps.InitializationVector,r=!!n&&e.oExtendedProps.InitializationVector;n&&(e.thumbnailSrc(""),e.sOwnerName===o.getUserPublicId()&&/\.(png|jpe?g|gif)$/.test(e.fileName())&&l.EnableJscrypto()?e.oActionsData.view.Handler=i.bind((function(){a.viewEncryptedImage(this.oFile,this.iv)}),{oFile:e,iv:r}):e.removeAction("view"),e.removeAction("list"),e.bIsSecure(!0))})),o.subscribeEvent("FileViewerWebclientPlugin::FilesCollection::after",(function(t){t.aFilesCollection(i.filter(t.aFilesCollection(),(function(t){return!(void 0!==t.oExtendedProps&&void 0!==t.oExtendedProps.InitializationVector)})))}))}t.exports=function(t){return l.init(t),a=n("QJDP"),{start:function(t){if(t.run("FilesWebclient","registerToolbarButtons",[(y||(y=n("uPeM")),y)]),window.Blob&&window.URL&&i.isFunction(window.URL.createObjectURL))if(p.chrome&&!f())N(t);else if(window.crypto&&window.crypto.subtle){var e=window.crypto.getRandomValues(new Uint8Array(16));window.crypto.subtle.importKey("raw",e,{name:"PBKDF2"},!1,["deriveBits","deriveKey"]).then((function(){N(t)}))}}}}},t19A:function(t,e,n){"use strict";var i=n("F/us"),o=n("0h2I"),r=n("czxF");function s(){r.call(this),this.fExportKeyCallback=null,this.keyName=o.observable("")}i.extendOwn(s.prototype,r.prototype),s.prototype.PopupTemplate="CoreParanoidEncryptionWebclientPlugin_ExportInformationPopup",s.prototype.onOpen=function(t,e){i.isFunction(t)&&(this.fExportKeyCallback=i.bind((function(){this.closePopup(),t()}),this)),this.keyName(e)},t.exports=new s},"uN/E":function(t,e,n){var i,o=o||function(t){"use strict";if(!(void 0===t||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var e=t.document,n=function(){return t.URL||t.webkitURL||t},i=e.createElementNS("http://www.w3.org/1999/xhtml","a"),o="download"in i,r=/constructor/i.test(t.HTMLElement)||t.safari,s=/CriOS\/[\d]+/.test(navigator.userAgent),a=function(e){(t.setImmediate||t.setTimeout)((function(){throw e}),0)},l=function(t){setTimeout((function(){"string"==typeof t?n().revokeObjectURL(t):t.remove()}),4e4)},c=function(t){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob([String.fromCharCode(65279),t],{type:t.type}):t},u=function(e,u,h){h||(e=c(e));var p,d=this,E="application/octet-stream"===e.type,y=function(){!function(t,e,n){for(var i=(e=[].concat(e)).length;i--;){var o=t["on"+e[i]];if("function"==typeof o)try{o.call(t,n||t)}catch(t){a(t)}}}(d,"writestart progress write writeend".split(" "))};if(d.readyState=d.INIT,o)return p=n().createObjectURL(e),void setTimeout((function(){var t,e;i.href=p,i.download=u,t=i,e=new MouseEvent("click"),t.dispatchEvent(e),y(),l(p),d.readyState=d.DONE}));!function(){if((s||E&&r)&&t.FileReader){var i=new FileReader;return i.onloadend=function(){var e=s?i.result:i.result.replace(/^data:[^;]*;/,"data:attachment/file;");t.open(e,"_blank")||(t.location.href=e),e=void 0,d.readyState=d.DONE,y()},i.readAsDataURL(e),void(d.readyState=d.INIT)}(p||(p=n().createObjectURL(e)),E)?t.location.href=p:t.open(p,"_blank")||(t.location.href=p);d.readyState=d.DONE,y(),l(p)}()},h=u.prototype;return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(t,e,n){return e=e||t.name||"download",n||(t=c(t)),navigator.msSaveOrOpenBlob(t,e)}:(h.abort=function(){},h.readyState=h.INIT=0,h.WRITING=1,h.DONE=2,h.error=h.onwritestart=h.onprogress=h.onwrite=h.onabort=h.onerror=h.onwriteend=null,function(t,e,n){return new u(t,e||t.name||"download",n)})}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);t.exports?t.exports.saveAs=o:null!==n("B9Yq")&&null!==n("PDX0")&&(void 0===(i=function(){return o}.call(e,n,e,t))||(t.exports=i))},uPeM:function(t,e,n){"use strict";n("0h2I"),n("RN+F"),n("Yjhd");function i(){this.storageType=null}i.prototype.useFilesViewData=function(t){this.storageType=t.storageType,t.pathItems.subscribe((function(){this.isEncryptedStorage()?t.disableButton(t.shortcutButtonModules,"CoreParanoidEncryptionWebclientPlugin"):t.enableButton(t.shortcutButtonModules,"CoreParanoidEncryptionWebclientPlugin")}),this)},i.prototype.isEncryptedStorage=function(){return"encrypted"===this.storageType()},t.exports=new i},wjWM:function(t,e,n){"use strict";var i=n("F/us"),o={Array2HexString:function(t){var e="";return i.each(t,(function(t){var n=t.toString(16);e+=(1===n.length?"0":"")+n})),e},HexString2Array:function(t){var e=[];if(0===t.length||t.length%2!=0)return e;for(var n=0;n<t.length;n+=2)e.push(parseInt(t.substr(n,2),16));return e}};t.exports=o},zDR0:function(t,e,n){"use strict";var i=n("F/us"),o=n("0h2I"),r=n("RN+F"),s=n("gcBV"),a=n("SQrT"),l=n("hPb3"),c=n("wjWM"),u=n("76Kh"),h=n("LU2F"),p=n("mtgd");function d(){this.sPrefix="user_"+(l.UserId||"0")+"_",this.key=o.observable(),this.keyName=o.observable(),this.storageName="cryptoKeyEncrypted"}d.prototype.key=null,d.prototype.sPrefix="",d.prototype.getKey=function(t,e,n,o){var s=this.loadKeyFromStorage(),a=new Promise(function(t,a){var l=i.bind((function(e){this.decryptKeyData(s,e).then(i.bind((function(e){this.generateKeyFromArray(e).then((function(e){t(e)})).catch((function(){a(new Error(r.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_LOAD_KEY")))}))}),this)).catch((function(){a(new Error(r.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_LOAD_KEY")))}))}),this);s?!this.key()||o?n?l(n):u.showPopup(h,[l,function(){i.isFunction(e)&&e()}]):t(this.key()):a(new Error(r.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/INFO_EMPTY_JSCRYPTO_KEY")))}.bind(this));this.loadKeyNameFromStorage(),a.then(i.bind((function(e){this.onKeyGenerateSuccess(e),i.isFunction(t)&&t(e)}),this)).catch(i.bind((function(t){i.isFunction(e)&&e(),this.onKeyGenerateError(t)}),this))},d.prototype.loadKeyNameFromStorage=function(){s.hasData(this.getStorageName())&&this.keyName(s.getData(this.getStorageName()).keyname)},d.prototype.loadKeyFromStorage=function(){var t="";return s.hasData(this.getStorageName())&&(t=s.getData(this.getStorageName()).keydata),t},d.prototype.generateKeyFromArray=function(t){return window.crypto.subtle.importKey("raw",t,{name:"AES-CBC"},!0,["encrypt","decrypt"])},d.prototype.onKeyGenerateSuccess=function(t){this.key(t)},d.prototype.onKeyGenerateError=function(t){t&&t.message&&a.showError(t.message)},d.prototype.generateKey=function(t,e){var n="";window.crypto.subtle.generateKey({name:"AES-CBC",length:256},!0,["encrypt","decrypt"]).then(i.bind((function(o){window.crypto.subtle.exportKey("raw",o).then(i.bind((function(l){n=c.Array2HexString(new Uint8Array(l)),u.showPopup(p,[i.bind((function(l){this.encryptKeyData(n,l).then(i.bind((function(n){s.setData(this.getStorageName(),{keyname:e,keydata:n}),this.loadKeyNameFromStorage(),this.onKeyGenerateSuccess(o),i.isFunction(t)&&t()}),this)).catch((function(){a.showError(r.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_LOAD_KEY"))}))}),this),function(){}])}),this)).catch((function(){a.showError(r.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_EXPORT_KEY"))}))}),this)).catch((function(){a.showError(r.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_GENERATE_KEY"))}))},d.prototype.importKeyFromString=function(t,e,n,o){try{u.showPopup(p,[i.bind((function(l){this.encryptKeyData(e,l).then(i.bind((function(e){s.setData(this.getStorageName(),{keyname:t,keydata:e}),this.getKey(n,o,l)}),this)).catch((function(){a.showError(r.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_LOAD_KEY")),i.isFunction(o)&&o()}))}),this),function(){i.isFunction(o)&&o()}])}catch(t){a.showError(r.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_IMPORT_KEY")),i.isFunction(o)&&o()}},d.prototype.exportKey=function(){return window.crypto.subtle.exportKey("raw",this.key())},d.prototype.deleteKey=function(){try{this.key(null),this.keyName(null),s.removeData(this.getStorageName())}catch(t){return{error:t}}return{status:"ok"}},d.prototype.decryptKeyData=function(t,e){var n=new Uint8Array(16);return new Promise(function(o,s){t?this.deriveKeyFromPasswordPromise(e,i.bind((function(e){crypto.subtle.decrypt({name:"AES-CBC",iv:n},e,new Uint8Array(c.HexString2Array(t))).then(i.bind((function(t){o(new Uint8Array(t))}),this)).catch((function(){s(new Error(r.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_LOAD_KEY")))}))}),this),(function(){s(new Error(r.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_LOAD_KEY")))})):s(new Error(r.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_LOAD_KEY")))}.bind(this))},d.prototype.encryptKeyData=function(t,e){var n=null,o=null,s=new Uint8Array(16);return new Promise(function(a,l){t?((n=c.HexString2Array(t)).length>0?n=new Uint8Array(n):l(new Error(r.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_LOAD_KEY"))),this.deriveKeyFromPasswordPromise(e,i.bind((function(t){crypto.subtle.encrypt({name:"AES-CBC",iv:s},t,n).then(i.bind((function(t){o=c.Array2HexString(new Uint8Array(t)),a(o)}),this)).catch((function(){l(new Error(r.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_LOAD_KEY")))}))}),this),(function(){l(new Error(r.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_LOAD_KEY")))}))):l(new Error(r.i18n("COREPARANOIDENCRYPTIONWEBCLIENTPLUGIN/ERROR_LOAD_KEY")))}.bind(this))},d.prototype.deriveKeyFromPasswordPromise=function(t,e,n){var o=function(t){if(window.TextEncoder)return new TextEncoder("utf-8").encode(t);for(var e=unescape(encodeURIComponent(t)),n=new Uint8Array(e.length),i=0;i<e.length;i++)n[i]=e.charCodeAt(i);return n};window.crypto.subtle.importKey("raw",o(t),{name:"PBKDF2"},!1,["deriveKey"]).then(i.bind((function(t){window.crypto.subtle.deriveKey({name:"PBKDF2",salt:o("the salt is this string"),iterations:1e5,hash:"SHA-256"},t,{name:"AES-CBC",length:256},!0,["encrypt","decrypt"]).then((function(t){i.isFunction(e)&&e(t)})).catch((function(){i.isFunction(n)&&n()}))}),this)).catch((function(){i.isFunction(n)&&n()}))},d.prototype.getStorageName=function(){return this.sPrefix+this.storageName},t.exports=new d}}]);