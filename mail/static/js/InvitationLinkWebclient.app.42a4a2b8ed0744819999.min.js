(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{"2ZjN":function(e,i,n){"use strict";var t=n("F/us"),s=n("AFLV");e.exports={ServerModuleName:"InvitationLinkWebclient",RegisterModuleName:"StandardRegisterFormWebclient",RegisterModuleHash:"register",LoginModuleHash:"login",EnableSendInvitationLinkViaMail:!0,init:function(e){var i=e.InvitationLinkWebclient;t.isEmpty(i)||(this.RegisterModuleName=s.pString(i.RegisterModuleName,this.RegisterModuleName),this.RegisterModuleHash=s.pString(i.RegisterModuleHash,this.RegisterModuleHash),this.LoginModuleHash=s.pString(i.LoginModuleHash,this.LoginModuleHash),this.EnableSendInvitationLinkViaMail=s.pBool(i.EnableSendInvitationLinkViaMail,this.EnableSendInvitationLinkViaMail))}}},"Km/U":function(e,i,n){"use strict";e.exports=function(e){n("fJbT");var i=n("F/us"),t=n("EVdn"),s=n("0h2I"),o=n("RN+F"),a=n("AFLV"),r=n("o0Bx"),u=n("IAk5"),l=n("QaF5"),d=n("SQrT"),I=n("hPb3"),R=n("2ZjN"),c=u.getUserRole()===Enums.UserRole.SuperAdmin,v=u.getUserRole()===Enums.UserRole.Anonymous,N=function(){var e=l.getCurrentHashArray();return e.length>=2&&e[0]===R.RegisterModuleHash?e[1]:""},h=N();return R.init(e),!u.isPublic()&&v?{start:function(e){u.subscribeEvent("StandardRegisterFormWebclient::ShowView::after",(function(e){"CRegisterView"===e.Name&&(""!==(h=N())?t.cookie("InvitationLinkHash",h,{expires:30}):t.removeCookie("InvitationLinkHash"),r.send(R.ServerModuleName,"GetUserPublicId",{InvitationLinkHash:h},(function(e){e.Result?u.broadcastEvent("ShowWelcomeRegisterText",{UserName:e.Result,WelcomeText:o.i18n("INVITATIONLINKWEBCLIENT/INFO_WELCOME",{USERNAME:e.Result,SITE_NAME:I.SiteName})}):(d.showError(o.i18n("INVITATIONLINKWEBCLIENT/REPORT_INVITATION_LINK_INCORRECT"),!0),l.setHash([R.LoginModuleHash]))})))})),u.subscribeEvent("SendAjaxRequest::before",(function(e){e.Module===R.RegisterModuleName&&"Register"===e.Method&&(e.Parameters.InvitationLinkHash=h)}))}}:(t.removeCookie("InvitationLinkHash"),""!==h&&(r.send(R.ServerModuleName,"GetUserPublicId",{InvitationLinkHash:h},(function(e){e.Result&&d.showReport(o.i18n("INVITATIONLINKWEBCLIENT/REPORT_LOGGED_IN"),0)})),u.subscribeEvent("clearAndReloadLocation::before",(function(e){e.OnlyReload=!0}))),c?{start:function(e){var n=0,t=0,I={},c={},v=null;u.subscribeEvent("ReceiveAjaxResponse::after",(function(e){if("CreateAuthenticatedUserAccount"===e.Response.Method&&"StandardAuth"===e.Response.Module&&e.Response.Result){var i=u.getUserId();delete I[i],delete c[i]}})),u.subscribeEvent("StandardAuthWebclient::ConstructView::after",(function(e){"CStandardAccountsSettingsFormView"===e.Name&&(e.View.showPasswordRevokesInvitationHint=s.observable(!1))})),u.subscribeEvent("CStandardAccountsSettingsFormView::onShow::after",(function(e){n=e.View.iUserId,e.View.showPasswordRevokesInvitationHint(!!c[n]),I[n]||r.send(R.ServerModuleName,"GetInvitationLinkHash",{UserId:n},(function(i,t){var s=a.pInt(t&&t.Parameters&&t.Parameters.UserId),o=i.Result?l.getAppUrlWithHash([R.RegisterModuleHash,i.Result]):"";s>0&&s===n&&(I[n]=o,c[n]=i.Result,e.View.showPasswordRevokesInvitationHint(!!c[n]))}))})),u.subscribeEvent("AdminPanelWebclient::ConstructView::after",(function(e){"CEditUserView"===e.Name&&(e.View.invitationLink=s.observable(""),e.View.bEnableSendInvitationLinkViaMail=R.EnableSendInvitationLinkViaMail,e.View.resendInvitationLink=function(){r.send(R.ServerModuleName,"SendNotification",{Email:e.View.publicId(),Hash:c[n]},(function(e){e.Result?d.showReport(o.i18n("INVITATIONLINKWEBCLIENT/REPORT_SEND_LINK")):d.showError(o.i18n("INVITATIONLINKWEBCLIENT/ERROR_SEND_LINK"))}))},v=e.View)})),u.subscribeEvent("CCommonSettingsPaneView::onRoute::after",(function(e){e.View&&i.isFunction(e.View.invitationLink)&&((n=a.pInt(e.Id))>0?(e.View.invitationLink(I[n]?I[n]:""),I[n]||r.send(R.ServerModuleName,"GetInvitationLinkHash",{UserId:n},(function(i,t){var s=a.pInt(t&&t.Parameters&&t.Parameters.UserId),o=i.Result?l.getAppUrlWithHash([R.RegisterModuleHash,i.Result]):"";s>0&&s===n&&(e.View.invitationLink(o),I[n]=o,c[n]=i.Result)}))):e.View.invitationLink(""))})),u.subscribeEvent("ReceiveAjaxResponse::after",(function(e){var i=e.Response;v&&"Core"===i.Module&&"CreateUser"===i.Method&&i.Result&&(t=a.pInt(i.Result)),t===n&&v&&"InvitationLinkWebclient"===i.Module&&"GetInvitationLinkHash"===i.Method&&i.Result&&(t=0,r.send(R.ServerModuleName,"SendNotification",{Email:v.publicId(),Hash:c[n]},(function(e){e.Result||d.showReport(o.i18n("INVITATIONLINKWEBCLIENT/ERROR_AUTO_SEND_LINK"))})))}))}}:null)}}}]);