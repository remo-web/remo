(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{"7vIj":function(t,e,s){"use strict";var n=s("0h2I"),i=s("IAk5");t.exports={ServerModuleName:"StandardAuth",HashModuleName:"standardauth",userAccountsCount:n.observable(0),accountsEmails:n.observableArray([]),init:function(t){i.registerUserAccountsCount(this.userAccountsCount),i.registerAccountsWithPass(this.accountsEmails)}}},SBlY:function(t,e,s){"use strict";var n=s("o0Bx"),i=s("7vIj");t.exports={send:function(t,e,s,o){n.send(i.ServerModuleName,t,e,s,o)}}},jDc1:function(t,e,s){"use strict";t.exports=function(t){var e=s("F/us"),n=s("RN+F"),i=s("IAk5"),o=s("OgeD"),r=s("7vIj"),c=i.getUserRole()===Enums.UserRole.SuperAdmin;return r.init(t),o.isModuleAvailable(r.ServerModuleName)?c?{start:function(t){t.run("AdminPanelWebclient","registerAdminPanelTab",[function(t){s.e(22).then(function(){t(s("uvLD"))}.bind(null,s)).catch(s.oe)},r.HashModuleName+"-accounts",n.i18n("STANDARDAUTHWEBCLIENT/ADMIN_PANEL_TAB_LABEL")])}}:i.isUserNormalOrTenant()?{start:function(t){i.subscribeEvent("ReceiveAjaxResponse::after",(function(t){t.Request.Module===r.ServerModuleName&&"GetUserAccounts"===t.Request.Method&&(r.userAccountsCount(e.isArray(t.Response.Result)?t.Response.Result.length:0),r.accountsEmails(e.isArray(t.Response.Result)?e.map(t.Response.Result,(function(t){return t.login||""})):0))})),t.run("SettingsWebclient","registerSettingsTab",[function(){return s("uvLD")},r.HashModuleName+"-accounts",n.i18n("STANDARDAUTHWEBCLIENT/USER_SETTINGS_TAB_LABEL")])}}:null:null}},uvLD:function(t,e,s){"use strict";var n,i=s("F/us"),o=s("EVdn"),r=s("0h2I"),c=s("RN+F"),u=s("76Kh"),a=s("20Ah"),A=s("JFZZ"),h=s("IAk5"),d=s("OgeD"),E=s("SQrT"),l=s("hPb3"),T=s("SBlY"),R=s("7vIj");function N(){n.call(this,l.ServerModuleName),this.sFakePass="xxxxxxxx",this.iUserId=h.getUserId(),this.accounts=r.observableArray([]),this.currentAccountId=r.observable(0),this.createAccountHeading=r.computed((function(){return 0===this.accounts().length?c.i18n("STANDARDAUTHWEBCLIENT/HEADING_CREATE_FIRST_ACCOUNT"):0===this.currentAccountId()?c.i18n("STANDARDAUTHWEBCLIENT/HEADING_CREATE_NEW_ACCOUNT"):c.i18n("STANDARDAUTHWEBCLIENT/HEADING_EDIT_NEW_ACCOUNT")}),this),this.updateButtonText=r.computed((function(){return 0===this.currentAccountId()?c.i18n("STANDARDAUTHWEBCLIENT/ACTION_CREATE"):c.i18n("STANDARDAUTHWEBCLIENT/ACTION_UPDATE")}),this),this.updateProgressButtonText=r.computed((function(){return 0===this.currentAccountId()?c.i18n("STANDARDAUTHWEBCLIENT/ACTION_CREATE_IN_PROGRESS"):c.i18n("STANDARDAUTHWEBCLIENT/ACTION_UPDATE_IN_PROGRESS")}),this),this.sUserPublicId="",this.login=r.observable(""),this.loginFocus=r.observable(!1),this.pass=r.observable(""),this.passFocus=r.observable(!1),this.confirmPass=r.observable(""),this.confirmPassFocus=r.observable(!1),this.visibleCreateForm=r.observable(!1),this.isCreating=r.observable(!1),h.isUserNormalOrTenant()&&(this.requestAccounts(),r.computed((function(){this.visible(this.accounts().length>0)}),this)),h.subscribeEvent(R.ServerModuleName+"::CreateUserAuthAccount",i.bind((function(t){T.send("CreateAuthenticatedUserAccount",{Login:t.Login,Password:t.Password},i.bind((function(e){e.Result?(this.accounts.push({id:e.Result.EntityId,login:t.Login}),h.broadcastEvent("OpenSettingTab",{Name:this.SettingsTabName})):A.showErrorByCode(e)}),this))}),this)),h.subscribeEvent("ReceiveAjaxResponse::after",i.bind((function(t){"Core"===t.Request.Module&&"GetUser"===t.Request.Method&&t.Response.Result&&t.Request.Parameters.Id===this.iUserId&&(this.sUserPublicId=t.Response.Result.PublicId,this.login(this.sUserPublicId))}),this)),h.broadcastEvent("StandardAuthWebclient::ConstructView::after",{Name:this.ViewConstructorName,View:this})}n=h.getUserRole()===Enums.UserRole.SuperAdmin?d.run("AdminPanelWebclient","getAbstractSettingsFormViewClass"):d.run("SettingsWebclient","getAbstractSettingsFormViewClass"),i.extendOwn(N.prototype,n.prototype),N.prototype.ViewTemplate="StandardAuthWebclient_StandardAccountsSettingsFormView",N.prototype.ViewConstructorName="CStandardAccountsSettingsFormView",N.prototype.onShow=function(){this.requestAccounts(),h.broadcastEvent("CStandardAccountsSettingsFormView::onShow::after",{Name:this.ViewConstructorName,View:this})},N.prototype.onRouteChild=N.prototype.onShow,N.prototype.requestAccounts=function(){T.send("GetUserAccounts",{UserId:this.iUserId},(function(t){i.isArray(t.Result)?this.accounts(t.Result):(A.showErrorByCode(t),this.accounts([])),0===this.accounts().length?this.openEditAccountForm(0):this.openEditAccountForm(this.accounts()[0].id)}),this)},N.prototype.setAccessLevel=function(t,e){this.visible("User"===t),this.iUserId!==e&&(this.accounts([]),this.hideEditAccountForm(),this.iUserId=e||-1,this.sUserPublicId="")},N.prototype.confirmAccountDeleting=function(t,e){u.showPopup(a,[c.i18n("STANDARDAUTHWEBCLIENT/CONFIRM_DELETE_ACCOUNT"),i.bind(this.deleteAccount,this,t),e])},N.prototype.deleteAccount=function(t,e){e&&T.send("DeleteAccount",{AccountId:t},(function(t){t.Result?E.showReport(c.i18n("STANDARDAUTHWEBCLIENT/REPORT_DELETE_ACCOUNT")):A.showErrorByCode(t,c.i18n("STANDARDAUTHWEBCLIENT/ERROR_DELETE_ACCOUNT")),this.requestAccounts()}),this)},N.prototype.openEditAccountForm=function(t){var e=i.find(this.accounts(),(function(e){return e.id===t}));e?(this.currentAccountId(t),this.login(e.login),this.pass(this.sFakePass),this.passFocus(!0),this.confirmPass("")):(this.currentAccountId(0),this.login(this.sUserPublicId),this.loginFocus(!0),this.pass(""),this.confirmPass("")),this.visibleCreateForm(!0)},N.prototype.saveAccount=function(){var t=o.trim(this.login()),e=o.trim(this.pass());""===t?this.loginFocus(!0):""===e||e===this.sFakePass?this.passFocus(!0):e!==o.trim(this.confirmPass())?(E.showError(c.i18n("COREWEBCLIENT/ERROR_PASSWORDS_DO_NOT_MATCH")),this.confirmPassFocus(!0)):0===this.currentAccountId()?T.send("CreateAuthenticatedUserAccount",{Login:t,Password:e},(function(t){t.Result?(E.showReport(c.i18n("STANDARDAUTHWEBCLIENT/REPORT_CREATE_ACCOUNT")),this.hideEditAccountForm(),this.requestAccounts()):A.showErrorByCode(t,c.i18n("STANDARDAUTHWEBCLIENT/ERROR_CREATE_ACCOUNT"))}),this):T.send("UpdateAccount",{AccountId:this.currentAccountId(),Password:e},(function(t){t.Result?(E.showReport(c.i18n("STANDARDAUTHWEBCLIENT/REPORT_UPDATE_ACCOUNT")),this.hideEditAccountForm()):A.showErrorByCode(t,c.i18n("STANDARDAUTHWEBCLIENT/ERROR_UPDATE_ACCOUNT")),this.requestAccounts()}),this)},N.prototype.hideEditAccountForm=function(){this.currentAccountId(0),this.visibleCreateForm(!1)},t.exports=new N}}]);